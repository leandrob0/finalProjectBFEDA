// Select every element that i will use.
const userimg = document.querySelector(".user__img");
const toggle = document.querySelector("#toggle-switch");
const body = document.querySelector("body");
const gamesContainer = document.querySelector(".games-container");
const logoutButton = document.querySelector(".user__log-out");

// When the page loads, checks if the localStorage item describing the user logged in exists.
// If it doesn't exist, it goes back to the login page (it means the user didn't log in.)
// If it exists, sets the photo from top right to the photo from the user.
// Also, gets the current color mode and sets it (because by default it is dark).
(function () {
  const userinfo = JSON.parse(localStorage.getItem("userinfo"));

  if (!userinfo) {
    location.href = "/";
  }

  userimg.src = `../resources/images/${userinfo.user.photo}`;

  const localStorageItem = JSON.parse(localStorage.getItem("carousel"));
  const mode = localStorageItem.mode;

  handleSwitchChange(mode === "dark" ? "light" : "dark");
})();

/*
############################################

    Code for the color mode switch functionality.

############################################
*/

function handleSwitchChange(mode) {
  if (mode === "dark") {
    body.classList.add("light-mode");
  } else {
    body.classList.remove("light-mode");
  }

  toggle.removeChild(toggle.lastChild);
  toggle.innerHTML += `<svg
  id="toggle-switch"
  width="44"
  height="22"
  viewBox="0 0 44 22"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  ${
    mode === "light"
      ? `<svg width="44" height="22" viewBox="0 0 44 22" fill="none" xmlns="http://www.w3.org/2000/svg">
  <rect width="44" height="22" rx="11" fill="#5F81FB"/>
  <circle cx="32" cy="11" r="9" fill="white"/>
  <path d="M11.6358 14.048C11.2411 14.048 10.8944 14.0107 10.5958 13.936C10.3024 13.856 10.0544 13.7147 9.85177 13.512C9.65443 13.304 9.5051 13.0027 9.40377 12.608C9.30777 12.2134 9.25977 11.6987 9.25977 11.064C9.25977 10.424 9.31043 9.90671 9.41177 9.51204C9.5131 9.11204 9.66243 8.80804 9.85977 8.60004C10.0624 8.38671 10.3104 8.24004 10.6038 8.16004C10.9024 8.08004 11.2464 8.04004 11.6358 8.04004C12.0358 8.04004 12.3851 8.08004 12.6838 8.16004C12.9824 8.24004 13.2304 8.38671 13.4278 8.60004C13.6251 8.80804 13.7718 9.11204 13.8678 9.51204C13.9691 9.90671 14.0198 10.424 14.0198 11.064C14.0198 11.6987 13.9691 12.2134 13.8678 12.608C13.7718 13.0027 13.6224 13.304 13.4198 13.512C13.2224 13.7147 12.9744 13.856 12.6758 13.936C12.3824 14.0107 12.0358 14.048 11.6358 14.048ZM11.6358 13.16C11.8971 13.16 12.1158 13.1334 12.2918 13.08C12.4731 13.0214 12.6171 12.92 12.7238 12.776C12.8304 12.6267 12.9078 12.416 12.9558 12.144C13.0038 11.8667 13.0278 11.5067 13.0278 11.064C13.0278 10.5947 13.0011 10.2214 12.9478 9.94404C12.8998 9.66137 12.8224 9.44804 12.7158 9.30404C12.6091 9.15471 12.4678 9.05604 12.2918 9.00804C12.1158 8.95471 11.8971 8.92804 11.6358 8.92804C11.3904 8.92804 11.1798 8.95471 11.0038 9.00804C10.8278 9.05604 10.6838 9.15471 10.5718 9.30404C10.4651 9.44804 10.3851 9.66137 10.3318 9.94404C10.2784 10.2214 10.2518 10.5947 10.2518 11.064C10.2518 11.5067 10.2731 11.8667 10.3158 12.144C10.3638 12.416 10.4411 12.6267 10.5478 12.776C10.6544 12.92 10.7958 13.0214 10.9718 13.08C11.1531 13.1334 11.3744 13.16 11.6358 13.16Z" fill="white"/>
  <path d="M15.0383 14V8.09604H15.8303L18.5183 12.312V8.09604H19.5103V14H18.7183L16.0303 9.78404V14H15.0383Z" fill="white"/>
  </svg>
  `
      : `<svg width="44" height="22" viewBox="0 0 44 22" fill="none" xmlns="http://www.w3.org/2000/svg">
  <rect width="44" height="22" rx="11" fill="#E1E1E4"/>
  <circle cx="12" cy="11" r="9" fill="white"/>
  <path d="M26.7764 14.048C26.3817 14.048 26.0351 14.0107 25.7364 13.936C25.4431 13.856 25.1951 13.7147 24.9924 13.512C24.7951 13.304 24.6457 13.0027 24.5444 12.608C24.4484 12.2133 24.4004 11.6987 24.4004 11.064C24.4004 10.424 24.4511 9.90668 24.5524 9.51201C24.6537 9.11201 24.8031 8.80801 25.0004 8.60001C25.2031 8.38668 25.4511 8.24001 25.7444 8.16001C26.0431 8.08001 26.3871 8.04001 26.7764 8.04001C27.1764 8.04001 27.5257 8.08001 27.8244 8.16001C28.1231 8.24001 28.3711 8.38668 28.5684 8.60001C28.7657 8.80801 28.9124 9.11201 29.0084 9.51201C29.1097 9.90668 29.1604 10.424 29.1604 11.064C29.1604 11.6987 29.1097 12.2133 29.0084 12.608C28.9124 13.0027 28.7631 13.304 28.5604 13.512C28.3631 13.7147 28.1151 13.856 27.8164 13.936C27.5231 14.0107 27.1764 14.048 26.7764 14.048ZM26.7764 13.16C27.0377 13.16 27.2564 13.1333 27.4324 13.08C27.6137 13.0213 27.7577 12.92 27.8644 12.776C27.9711 12.6267 28.0484 12.416 28.0964 12.144C28.1444 11.8667 28.1684 11.5067 28.1684 11.064C28.1684 10.5947 28.1417 10.2213 28.0884 9.94401C28.0404 9.66134 27.9631 9.44801 27.8564 9.30401C27.7497 9.15468 27.6084 9.05601 27.4324 9.00801C27.2564 8.95468 27.0377 8.92801 26.7764 8.92801C26.5311 8.92801 26.3204 8.95468 26.1444 9.00801C25.9684 9.05601 25.8244 9.15468 25.7124 9.30401C25.6057 9.44801 25.5257 9.66134 25.4724 9.94401C25.4191 10.2213 25.3924 10.5947 25.3924 11.064C25.3924 11.5067 25.4137 11.8667 25.4564 12.144C25.5044 12.416 25.5817 12.6267 25.6884 12.776C25.7951 12.92 25.9364 13.0213 26.1124 13.08C26.2937 13.1333 26.5151 13.16 26.7764 13.16Z" fill="#939393"/>
  <path d="M30.1149 14V9.38401C30.1149 9.13334 30.1522 8.92534 30.2269 8.76001C30.3016 8.58934 30.4002 8.45601 30.5229 8.36001C30.6509 8.26401 30.7896 8.19734 30.9389 8.16001C31.0936 8.11734 31.2456 8.09601 31.3949 8.09601C31.6029 8.09601 31.8482 8.09868 32.1309 8.10401C32.4136 8.10401 32.7096 8.11201 33.0189 8.12801C33.3282 8.13868 33.6269 8.15734 33.9149 8.18401V9.00801H31.6589C31.4829 9.00801 31.3442 9.05868 31.2429 9.16001C31.1469 9.25601 31.0989 9.38934 31.0989 9.56001V10.752L33.5549 10.808V11.584L31.0989 11.64V14H30.1149Z" fill="#939393"/>
  <path d="M34.654 14V9.38401C34.654 9.13334 34.6913 8.92534 34.766 8.76001C34.8406 8.58934 34.9393 8.45601 35.062 8.36001C35.19 8.26401 35.3286 8.19734 35.478 8.16001C35.6326 8.11734 35.7846 8.09601 35.934 8.09601C36.142 8.09601 36.3873 8.09868 36.67 8.10401C36.9526 8.10401 37.2486 8.11201 37.558 8.12801C37.8673 8.13868 38.166 8.15734 38.454 8.18401V9.00801H36.198C36.022 9.00801 35.8833 9.05868 35.782 9.16001C35.686 9.25601 35.638 9.38934 35.638 9.56001V10.752L38.094 10.808V11.584L35.638 11.64V14H34.654Z" fill="#939393"/>
  </svg>
  `
  }
</svg>`;
}

toggle.addEventListener("click", () => {
  const localStorageItem = JSON.parse(localStorage.getItem("carousel"));
  const mode = localStorageItem.mode;

  handleSwitchChange(mode);

  localStorage.setItem(
    "carousel",
    JSON.stringify({
      ...localStorageItem,
      mode: mode === "dark" ? "light" : "dark",
    })
  );
});

// Cards simulation to test the cards visuals.
const cards = [
  {
    image: "https://via.placeholder.com/363x179",
    title: "Devils May Cry",
    release: "25-01-2021",
    genres: ["Action", "RPG"],
  },
  {
    image: "https://via.placeholder.com/363x179",
    title: "Biomutant",
    release: "25-01-2021",
    genres: ["Action", "RPG"],
  },
  {
    image: "https://via.placeholder.com/363x179",
    title: "Biomutant",
    release: "25-01-2021",
    genres: ["Action", "RPG"],
  },
  {
    image: "https://via.placeholder.com/363x179",
    title: "Biomutant",
    release: "25-01-2021",
    genres: ["Action", "RPG"],
  },
  {
    image: "https://via.placeholder.com/363x179",
    title: "Biomutant",
    release: "25-01-2021",
    genres: ["Action", "RPG", "Adventure"],
  },
  {
    image: "https://via.placeholder.com/363x179",
    title: "Biomutant",
    release: "25-01-2021",
    genres: ["Action", "RPG"],
  },
  {
    image: "https://via.placeholder.com/363x179",
    title: "Biomutant",
    release: "25-01-2021",
    genres: ["Action", "RPG"],
  },
];

(function () {
  cards.forEach((card) => {
    gamesContainer.innerHTML += `<article class="card">
        <img
          class="card__image"
          src="${card.image}"
          alt="placeholder image"
        />
        <div class="first-row">
          <h2 class="game-title">${card.title}</h2>
          <span class="game-ranking">#1</span>
        </div>
        <div class="second-row">
          <div class="text-container info-key"><p>Release date:</p>
            <p class="date-release info-value">${card.release}</p></div>
          <div class="icon-container">
            <svg
              width="24"
              height="20"
              viewBox="0 0 24 20"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M9.55176 9.53674e-06L9.55176 18.2774L13.3605 19.5885L13.3605 4.26319C13.3605 3.54103 13.6568 3.06155 14.1321 3.22645C14.7535 3.41372 14.8743 4.07895 14.8743 4.79307L14.8743 10.9138C17.245 12.1606 19.1115 10.9131 19.1115 7.62345C19.1115 4.26188 18.0172 2.76435 14.7973 1.56033C13.5273 1.10084 11.1735 0.325457 9.55176 9.53674e-06Z"
                class="icon-color"
              />
              <path
                d="M14.3506 16.9129L20.1079 14.3203C20.7592 14.0148 20.8587 13.5998 20.3316 13.3817C19.7962 13.1596 18.8406 13.2232 18.1824 13.5222L14.3506 15.2325V12.5036L14.57 12.412C14.57 12.412 15.6792 11.9148 17.2392 11.7008C18.7962 11.4848 20.7057 11.7289 22.2065 12.4446C23.8971 13.1241 24.0866 14.1153 23.6589 14.8051C23.2249 15.4877 22.1728 15.9815 22.1728 15.9815L14.3506 19.5367"
                class="icon-color"
              />
              <path
                d="M1.7099 17.2146C-0.0868735 16.6444 -0.386499 15.4395 0.433179 14.7435C1.18926 14.1079 2.47691 13.6295 2.47691 13.6295L7.79974 11.4675V13.9281L3.97289 15.4908C3.29503 15.767 3.1934 16.1557 3.73939 16.359C4.29514 16.5706 5.28141 16.5137 5.95966 16.2286L7.79974 15.4728V17.6695C7.68114 17.6921 7.54927 17.715 7.42892 17.7384C5.5943 18.0852 3.63971 17.9428 1.7099 17.2146Z"
                class="icon-color"
              />
              <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M23.7661 19.4589C23.6149 19.6145 23.4164 19.7024 23.2027 19.7024C22.989 19.7024 22.784 19.6145 22.6326 19.4589C22.4831 19.3005 22.4004 19.0936 22.4004 18.8706C22.4004 18.4089 22.7591 18.0357 23.2027 18.0357C23.4164 18.0357 23.6149 18.1208 23.7661 18.2798C23.9156 18.4352 24 18.6456 24 18.8706C24 19.0936 23.9156 19.3005 23.7661 19.4589ZM22.5352 18.8707C22.5352 18.6808 22.6033 18.5067 22.7279 18.3776C22.8555 18.2458 23.0258 18.1747 23.2027 18.1747C23.3798 18.1747 23.5458 18.2458 23.6703 18.3776C23.7959 18.5067 23.8638 18.6808 23.8638 18.8707C23.8638 19.2511 23.567 19.5599 23.2027 19.5599C23.0258 19.5599 22.8555 19.4896 22.7279 19.3594C22.6033 19.2281 22.5352 19.0558 22.5352 18.8707ZM23.5677 19.2169C23.5748 19.2384 23.5835 19.2511 23.5958 19.2548L23.607 19.2614V19.3143H23.4334L23.4302 19.3036L23.4184 19.2717C23.4164 19.2548 23.4141 19.2328 23.4117 19.1957L23.404 19.0508C23.402 18.9993 23.3859 18.9694 23.3561 18.9496C23.334 18.9419 23.3039 18.9359 23.259 18.9359H23.018V19.3143H22.8599V18.3849H23.2745C23.3421 18.3849 23.399 18.3975 23.4426 18.4167C23.53 18.4596 23.5748 18.5368 23.5748 18.6455C23.5748 18.6988 23.5621 18.7487 23.5402 18.7856C23.5212 18.8116 23.4988 18.8353 23.4744 18.8585L23.4809 18.8633C23.4974 18.8754 23.5138 18.8874 23.5235 18.9051C23.5456 18.9305 23.5556 18.9731 23.5574 19.028L23.5614 19.1463C23.5621 19.1766 23.5644 19.2002 23.5677 19.2169ZM23.3807 18.7599C23.4063 18.7427 23.4184 18.7085 23.4184 18.6561C23.4184 18.6009 23.4001 18.5641 23.3642 18.5458C23.3421 18.5368 23.3146 18.5303 23.2779 18.5303H23.018V18.7914H23.2635C23.3123 18.7914 23.3511 18.7809 23.3807 18.7599Z"
                class="icon-color"
              />
            </svg>
            <svg
              width="20"
              height="20"
              viewBox="0 0 20 20"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M10 0C11.9286 0 13.5238 0.616246 14.9762 1.65266C15 1.65266 15 1.68067 15 1.70868C15 1.73669 14.9762 1.73669 14.9524 1.73669C13.0952 1.2605 10.2857 3.13725 10.0238 3.33333H10H9.97619C9.71429 3.13725 6.90476 1.2605 5.04762 1.73669C5.02381 1.73669 5 1.73669 5 1.70868C5 1.68067 5 1.65266 5.02381 1.65266C6.47619 0.616246 8.07143 0 10 0ZM16.3903 17.5988C17.8903 16.0464 12.9308 10.5648 10.0035 8.33333C10.0035 8.33333 9.97935 8.33333 9.97935 8.35759C7.07626 10.5648 2.09261 16.0464 3.61674 17.5988C5.31021 19.1026 7.56011 20 10.0035 20C12.447 20 14.6727 19.1026 16.3903 17.5988ZM2.73973 3.38078C2.72831 3.38078 2.7226 3.38705 2.7169 3.39332C2.71119 3.39959 2.70548 3.40585 2.69406 3.40585C1.0274 5.2358 0 7.76763 0 10.5501C0 12.8313 0.707763 14.9621 1.87215 16.6416C1.87215 16.6667 1.89498 16.6667 1.91781 16.6667C1.94064 16.6667 1.94064 16.6416 1.91781 16.6165C1.21005 14.2351 4.79452 8.4946 6.64384 6.0881L6.66667 6.06303C6.66667 6.03796 6.66667 6.03796 6.64384 6.03796C3.83562 2.9797 2.89954 3.30558 2.73973 3.38078ZM13.3333 6.05268L13.3562 6.02759C16.1644 2.99144 17.1005 3.31764 17.2374 3.36782C17.2469 3.36782 17.2525 3.36782 17.2574 3.36962C17.2642 3.37215 17.2698 3.37825 17.2831 3.39291C18.9726 5.22464 20 7.75895 20 10.5442C20 12.8276 19.2922 14.9604 18.1279 16.6416C18.1279 16.6667 18.105 16.6667 18.0822 16.6667V16.6165C18.7671 14.2327 15.2055 8.48662 13.3562 6.07777C13.3333 6.07777 13.3333 6.05268 13.3333 6.05268Z"
                class="icon-color"
              />
            </svg>
            <svg
              width="20"
              height="20"
              viewBox="0 0 20 20"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M20 9.16667H9.16667V1.53647L20 0V9.16667ZM8.33333 1.66667V9.16667H0V2.77865L8.33333 1.66667ZM8.33333 10H0V17.0992L8.33333 18.3333V10ZM9.16667 18.3262V10H20V20L9.16667 18.3262Z"
                class="icon-color"
              />
            </svg>
          </div>
        </div>
        <div class="third-row">
          <p class="info-key">Genres:</p>
          <p class="info-value genres-margin">${card.genres.join(", ")}</p>
        </div>
      </article>`;
  });
})();

/*
############################################

    Code for the log out functionality.

############################################
*/

logoutButton.addEventListener("click", () => {
  localStorage.removeItem("userinfo");
});
